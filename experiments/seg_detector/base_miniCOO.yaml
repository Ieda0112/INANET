# このファイルはbase_totaltext.yamlをベースに、COOデータセット用に修正したものです
import:
    - '/home/shunsuke_ieda@pip.waseda.ac.jp/workspace/2022/shunsuke_ieda/Master/INANET_ieda/experiments/seg_detector/base.yaml'
package:
    - 'decoders.seg_detector_loss'
define:
  - name: train_data
    class: ImageDataset
    data_dir:
        - './datasets/mini_COO'
    data_list:
        - './datasets/mini_COO/train_list.txt'
    processes:
        - class: AugmentDetectionData
        # データ拡張の説明:
          augmenter_args:
              # 水平方向に50%の確率で反転、文字検出でいるか？
              - ['Fliplr', 0.5]
              # -10度から10度の範囲でランダムに回転
              - {'cls': 'Affine', 'rotate': [-10, 10]}
              - ['Resize', [0.5, 3.0]]
          only_resize: False
          keep_ratio: False
        - class: RandomCropData
          size: [640, 640]
          max_tries: 10
        - class: MakeICDARData
        - class: MakeSegDetectionData
        - class: MakeBorderMap
        - class: NormalizeImage
        - class: FilterKeys
          superfluous: ['polygons', 'filename', 'shape', 'ignore_tags', 'is_training']
  
  # Train-like validation dataset (for epoch-end loss computation during training)
  - name: validate_data_trainlike
    class: ImageDataset
    data_dir:
        - './datasets/mini_COO'
    data_list:
        - './datasets/mini_COO/valid_list.txt'
    processes:
        - class: AugmentDetectionData
          # validate時はランダム要素をなくして再現性を確保
          augmenter_args:
              - ['Resize', {'width': 640, 'height': 640}]
          only_resize: True
          keep_ratio: False
        # - class: RandomCropData
        #   size: [640, 640]
        #   max_tries: 10
        - class: MakeICDARData
        - class: MakeSegDetectionData
        - class: MakeBorderMap
        - class: NormalizeImage
        - class: FilterKeys
          superfluous: ['polygons', 'filename', 'shape', 'ignore_tags', 'is_training']

  - name: validate_data
    class: ImageDataset
    data_dir:
        - './datasets/mini_COO'
    data_list:
        - './datasets/mini_COO/test_list.txt'
    processes:
        - class: AugmentDetectionData
          augmenter_args:
              - ['Resize', {'width': 800, 'height': 800}]
          only_resize: True
          keep_ratio: True
        - class: MakeICDARData
        - class: MakeSegDetectionData
        - class: NormalizeImage
